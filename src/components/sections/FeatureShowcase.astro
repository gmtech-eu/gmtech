---
import { Image } from 'astro:assets';
import featureShowcaseData from '@data/featureShowcase.json';

// Import default images as fallbacks
import image_1 from '@images/analytics.webp';
import image_2 from '@images/program_management.webp';
import image_3 from '@images/cultural_bridge.webp';

const { title, subtitle, features: cmsFeatures } = featureShowcaseData;

// Map to associate default images
const imageMap: Record<string, any> = {
  '@images/analytics.webp': image_1,
  '@images/program_management.webp': image_2,
  '@images/cultural_bridge.webp': image_3,
};

// CSS classes for layout (keeping original design)
const featureClasses = [
  'content-center border-b border-dashed border-slate-400 py-5 sm:col-span-2 sm:p-5',
  'content-center py-5 sm:row-start-2 sm:p-5 sm:py-10',
  'content-center border-t border-dashed border-slate-400 py-5 sm:row-span-2 sm:row-start-2 sm:border-l sm:border-t-0 sm:p-5 sm:text-right',
  'content-center border-t border-dashed border-slate-400 py-5 sm:p-5'
];

const imageAlignments = [
  'mx-auto mt-10 rounded-xl shadow-lg sm:w-[75%]',
  'ml-auto mr-auto mt-10 w-[65%] rounded-xl shadow-lg sm:ml-0 sm:w-[45%]',
  'ml-auto mr-auto mt-10 w-[80%] rounded-xl shadow-lg sm:mr-0',
  ''
];

// Process features from CMS
const processedFeatures = cmsFeatures.map((feature, index) => ({
  ...feature,
  class: featureClasses[index] || 'content-center py-5 sm:p-5',
  alignment: imageAlignments[index] || '',
  processedImage: feature.image.discriminant && feature.image.value ? imageMap[feature.image.value.src] : null,
  moreFeatures: feature.additionalItems.discriminant ? feature.additionalItems.value : null
}));
---

<div class="mx-auto max-w-[85rem] px-4 py-10 sm:px-6 md:py-14 lg:px-8 lg:py-20">
  {/* Section container for the title and subtitle */}
  <div class="mx-auto mb-10 max-w-2xl text-center lg:mb-14">
    <h2 class="text-2xl font-semibold text-balance text-slate-800 md:text-3xl md:leading-tight">
      <Fragment set:html={title} />
    </h2>
    <p class="mt-1 text-pretty text-slate-600">
      <Fragment set:html={subtitle} />
    </p>
  </div>

  <div class="mx-auto grid max-w-[85rem] px-4 pb-10 sm:grid-cols-2 sm:grid-rows-3 sm:px-6 lg:px-8 lg:pb-14">
    {
      processedFeatures.map((feature) => (
        <div class={`${feature.class}`}>
          <h2 class="text-2xl font-bold text-slate-600">{feature.title}</h2>

          {feature.description && (
            <p class="mt-2 text-base/6 text-slate-600">
              <Fragment set:html={feature.description} />
            </p>
          )}

          {feature.processedImage && (
            <Image 
              class={`${feature.alignment || ''}`} 
              src={feature.processedImage} 
              alt={feature.image.value?.alt || ""} 
            />
          )}

          {feature.moreFeatures && (
            <ul class="mt-4 ml-4 w-4/5 list-inside list-disc space-y-2 text-base/6 text-slate-600 marker:text-teal-600">
              {feature.moreFeatures.map((item) => (
                <li>{item}</li>
              ))}
            </ul>
          )}
        </div>
      ))
    }
  </div>
</div>
